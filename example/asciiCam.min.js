!function(a){function s(a={}){var{sourceNode,audioOnFlag,exitCallback,showInputStream}=k(a);if(!sourceNode)throw{id:2,msg:"Can not find source video node reference in config object"};if(!g())throw{id:3,msg:"navigator.getUserMedia not supported"};if(!h())throw{id:4,msg:"window.URL not supported"};sourceNode.style.display="none";var b=i(sourceNode,sourceNode.width,sourceNode.height,showInputStream),c=!1;return l(sourceNode,audioOnFlag).then(()=>{sourceNode.addEventListener("loadedmetadata",function(a){s.play=(()=>{c=!0,q(b.getContext("2d"),sourceNode,exitCallback)}),c&&s.play()})}).catch(a=>{throw{id:1,msg:"Set stream source error",data:a}}),s.play=(()=>{c=!0}),s.stop=(()=>{c=!1,r()}),p([[document.getElementById("asciiCam-play"),s.play],[document.getElementById("asciiCam-stop"),s.stop]]),{play:s.play,stop:s.stop}}var b={width:100,height:80},c={width:640,height:480},d={sourceNode:null,audioOnFlag:!1,showInputStream:!0,streamWidth:400,streamHeight:300,exitCallback:()=>{throw{id:5,msg:"Can not find exitCallback function"}}},e=!0,f=null,g=()=>{return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,!!navigator.getUserMedia},h=()=>{return a.URL=a.URL||window.webkitURL,!!a.URL},i=(a,b,c,d)=>{var e=document.createElement("canvas");return e.width=b,e.height=c,e.id="asciiCam-out-image",d||(e.style.display="none"),a.parentNode.insertBefore(e,a.nextSibling),e},j=a=>{var b=document.createElement("pre");return b.style.fontFamily="Courier New",b.style.fontSize="1px",a.appendChild(b),b},k=a=>{var e=(()=>{var b=document.getElementById("asciiCam-exitContainer"),c=null;return b?(c=j(b),function(a){c.textContent=a}):a.exitCallback&&"function"==typeof a.exitCallback?a.exitCallback:d.exitCallback})(),f=((b,c)=>{var e=(a,b,c)=>{return!(!a.width||!a.height)&&(!(a.width<b.width||a.width>c.width)&&!(a.height<b.height||a.height>c.height))},f=(a,b,c,e,f)=>{return f(a,b,c)?a:(e.streamWidth&&e.streamHeight&&e.streamWidth>b.width&&e.streamWidth<c.width&&e.streamHeight>b.height&&e.streamHeight<c.height?(a.width=e.streamWidth,a.height=e.streamHeight):(a.width=d.streamWidth,a.height=d.streamHeight,console.info("Stream are oversized. Default settings was set")),a)};return d.sourceNode=document.getElementById("asciiCam-source"),a.sourceNode&&a.sourceNode instanceof HTMLElement&&"video"==a.sourceNode.nodeName.toLowerCase()?f(a.sourceNode,b,c,a,e):d.sourceNode&&d.sourceNode instanceof HTMLElement&&"video"==d.sourceNode.nodeName.toLowerCase()?f(d.sourceNode,b,c,a,e):void 0})(b,c);return{audioOnFlag:a.audioOnFlag&&"boolean"==typeof a.audioOnFlag?a.audioOnFlag:d.audioOnFlag,showInputStream:a.showInputStream&&"boolean"==typeof a.showInputStream?a.showInputStream:d.showInputStream,sourceNode:f,exitCallback:e}},l=(a,b)=>{return new Promise((c,d)=>{navigator.getUserMedia({video:{width:{max:320},height:{max:240}},audio:b},b=>{a.src=window.URL.createObjectURL(b),a.play(),c()},a=>{d(a)})})},m=(a,b,c,d,g,h)=>{return e?void cancelAnimationFrame(f):(a.drawImage(b,0,0,b.width,b.height),h(n(a.getImageData(0,0,b.width,b.height).data,c,d,g)),void(f=requestAnimationFrame(()=>{m(a,b,c,d,g,h)})))},n=(a,b,c,d)=>{for(var e="",f=0,g=0;g<b;g+=4)f=.34*a[g]+.5*a[g+1]+.16*a[g+2],e+=g>0&&g/4%c==0?"\n":"",e+=d(f);return e},o=(a="normal")=>{return"normal"==a?function(a){return a>=230?" ":a>=200?".":a>=180?"*":a>=160?":":a>=130?"o":a>=100?"&":a>=70?"8":a>=50?"#":"@"}:function(a){return a>=230?"@":a>=200?"#":a>=180?"8":a>=160?"&":a>=130?"o":a>=100?":":a>=70?"*":a>=50?".":" "}},p=a=>{a.forEach(([a,b])=>{a&&a.addEventListener("click",()=>{b()})})},q=(a,b,c)=>{var d=a.getImageData(0,0,b.width,b.height).data,f=o();e=!1;var g=m.bind(null,a,b,d.length,d.length/b.height/4,f,c);g()},r=()=>{e=!0};a.asciiCam=s}(window);